@page "/admin/{id:int}/route"
@layout RunTogether.Shared.Layouts.OrganiserLayout

@using Microsoft.AspNetCore.Identity
@using RunTogether.Shared.Forms
@using RunTogether.Areas.Identity
@using System.Collections.Generic
@using RunTogether.Data
@using Microsoft.EntityFrameworkCore;
@using RunTogether.Shared.Map

@inject DialogService dialogService
@inject UserManager<ApplicationUser> userManager
@inject ApplicationDbContext dbContext

<h3>Route</h3>
<div class="row">
    <div class="col-md-10">

        <LeafletMapEditor sendToParent="reciveFromChild" Run="@run"></LeafletMapEditor>

    </div>
    <div class="col-md-2">
        <h3></h3>
        <RadzenCard>
            <RadzenTemplateForm TItem="StageAssignment" Data="@test" Submit="()=> Save()">
                @for (int i = 0; i < rows; i++)
                {
                    int i2 = i;
                    <div class="row" Style="margin-bottom: 10px">
                        <div class="col-md-8">
                            <RadzenLabel text=@($"{i+1}. Løber") />
                            <RadzenDropDown Name="DropDown" AllowClear="true" TValue="ApplicationUser" Data="@run.Runners" @bind-Value="@selectedStage.AssignedRunners[i2].Runner" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                            AllowFiltering="true" Placeholder="Vælg løber..." TextProperty="LastName" Change="args => Change((ApplicationUser)args, i2)" Style="width:100%">
                                <Template Context="data">
                                    @((data as ApplicationUser).FirstName)  @((data as ApplicationUser).LastName)
                                    <br>
                                    (@((data as ApplicationUser).Email))
                                </Template>
                            </RadzenDropDown>
                            <RadzenRequiredValidator Component="DropDown" Text="Skal udfyldes eller slettes" Style="position: relative" />
                        </div>
                        <div class="col-md-4">
                            <br>
                            <RadzenButton Icon="delete" Size="ButtonSize.Small" Click="@(args => Delete(i2))" />
                        </div>
                    </div>
                }
                <div class="row">
                    <RadzenButton Icon="add_box" Size="ButtonSize.Small" Click="Add" /><br>
                    <RadzenButton ButtonType="ButtonType.Submit" Icon="save" Text="Gem"/>
                </div>
            </RadzenTemplateForm>
        </RadzenCard>
    </div>
</div>
