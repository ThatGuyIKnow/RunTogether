@inject DialogService dialogService
@inject IJSRuntime JSRuntime
@using Data
@inject ApplicationDbContext dbContext


<div class="row">
    <div class="col-md-12">
        <h3>Rutens navn:</h3>
        <RadzenTextBox Placeholder="Indtast navn" Style="margin-bottom: 20px; width: 200px" />
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div id="mapid" ; style="height: 200px"></div>
        <br />

        @*Button that allows for adding a new stage, via the ShowAddStageDialog*@
        <RadzenButton Text=@($"Tilføj nyt segment") Click="@ShowAddStageDialog" />
        <br />
        <br />

        @*Grid that shows the stages belonging to the new route*@
        @*Skal tilføje flere felter*@
        <RadzenGrid @ref="table" Data="@runRoute.Stages" AllowFiltering="true" AllowSorting="true" TItem="Stage" RowSelect="@(args => Selected = args)">
            <Columns>
                @*<RadzenGridColumn TItem="Stage" Property="StageId" Title="ID" />*@
                <RadzenGridColumn TItem="Stage" Property="Date" Title="Startdato" />
                <RadzenGridColumn TItem="Stage" Property="StartPoint.Coordinates" Title="Startlokation" />
                <RadzenGridColumn TItem="Stage" Property="EndPoint.Coordinates" Title="Slutlokation" />
            </Columns>
        </RadzenGrid>
        <br />

        @*<RadzenGrid AllowFiltering="true" AllowPaging="true" AllowSorting="true" Data="@(new List<Stage>(){Selected})" TItem="Stage">
            <Columns>
                <RadzenGridColumn TItem="Stage" Property="stage.StageId" Title="ID" />
                <RadzenGridColumn TItem="Stage" Property="stage.Date" Title="Startdato" />
                <RadzenGridColumn TItem="Stage" Property="stage.RunRouteId" Title="RuteID" />
            </Columns>
        </RadzenGrid>*@

        <RadzenButton Text=@($"Gem rute") Click="@SaveRouteChanges" Style="margin-bottom: 20px; width: 200px" />
        <RadzenButton Text=@($"Annuller") Click="@CancelRouteChanges" ButtonStyle="ButtonStyle.Secondary" Style="margin-bottom: 20px; width: 200px" />
    </div>
</div>

    


@code {

    async Task ShowAddStageDialog() => await dialogService.OpenAsync("Tilføj segment", ds =>
        @<RadzenTemplateForm TItem="Stage">
            
            <div id="mapid" ; style="height: 200px"></div>

            <div class="row" style="margin-bottom: 48px">
                <div class="col-md-4">
                    <RadzenLabel Text="Startdato" />
                </div>
                <div class="col">
                    <RadzenDatePicker Name="Date" DateFormat="d" @bind-Value="date" /><br>
                    @*<RadzenRequiredValidator Component="Date" Text="Start date is required" Popup=true Style="position: absolute" />*@
                </div>
            </div>

            <div class="row" style="margin-bottom: 48px">
                <div class="col-md-4">
                    <RadzenLabel Text="Startlokation X" />
                </div>
                <div class="col-md-4">
                    <RadzenNumeric TValue="float" @bind-Value="xCoordinateStart" Placeholder="Startlokation X" />
                </div>
            </div>

            <div class="row" style="margin-bottom: 48px">
                <div class="col-md-4">
                    <RadzenLabel Text="Startlokation Y" />
                </div>
                <div class="col-md-4">
                    <RadzenNumeric TValue="float" @bind-Value="yCoordinateStart" Placeholder="Startlokation Y" />
                </div>
            </div>

            <div class="row" style="margin-bottom: 48px">
                <div class="col-md-4">
                    <RadzenLabel Text="Slutlokation X" />
                </div>
                <div class="col-md-4">
                    <RadzenNumeric TValue="float" @bind-Value="xCoordinateEnd" Placeholder="Slutlokation X" />
                </div>
            </div>

            <div class="row" style="margin-bottom: 48px">
                <div class="col-md-4">
                    <RadzenLabel Text="Slutlokation Y" />
                </div>
                <div class="col-md-4">
                    <RadzenNumeric TValue="float" @bind-Value="yCoordinateEnd" Placeholder="Slutlokation Y" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    @*<RadzenButton ButtonType="ButtonType.Submit" Text="OK" Style="margin-bottom: 10px; width: 150px" />*@
                    <RadzenButton Click="()=> OnSubmit(date, xCoordinateStart, yCoordinateStart, xCoordinateEnd, yCoordinateEnd)" Text="OK" Style="margin-bottom: 10px; width: 150px" />
                    <RadzenButton Click="()=> ds.Close(false)" ButtonStyle="ButtonStyle.Secondary" Text="Cancel" Style="margin-bottom: 10px; width: 150px" />
                </div>
            </div>
        </RadzenTemplateForm>
    );

    
    }
